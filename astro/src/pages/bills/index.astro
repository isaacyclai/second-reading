---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import PaginatedList from "../../components/islands/PaginatedList";
import { getBills, getBillCount } from "../../lib/db";
import type { ListItem } from "../../lib/types";

const PAGE_SIZE = 24;
const totalCount = getBillCount();
const bills = getBills(PAGE_SIZE, 0);

// Transform to match the ListItem interface
const initialItems: ListItem[] = bills.map((b) => ({
  id: b.id,
  title: b.title,
  date: b.firstReadingDate || undefined,
  ministry: b.ministry || undefined,
  firstReadingDate: b.firstReadingDate || undefined,
  hasSecondReading: b.hasSecondReading || false,
}));
---

<Layout title="Bills" description="Bills">
  <h1 class="font-display text-display-lg text-ink mb-4">Bills</h1>

  <div
    class="font-body text-base text-ink-soft leading-relaxed mb-8 space-y-3 text-pretty"
  >
    <p>
      Here, you can find bills that have been introduced, debated, and passed in
      Parliament. Bills are the first step in the process of making laws, and
      are first introduced by a Minister on behalf of the Government. MPs can
      also introduce Private Member's Bills.
    </p>
    <p>
      In the second reading, the principles and merits of the bill are debated,
      after which members vote on the bill. If the bill seeks to amend the
      Consitution, then a supermajority (two-thirds) is required for the bill to
      move on to the next stage. Otherwise, a simple majority (half) is
      sufficient. If a majority cannot be reached, the bill will go through a
      third reading after being amended. For a more detailed description of the
      full process, please refer to the official <a
        href="https://www.parliament.gov.sg/about-us/parliament-information/functions"
        class="text-accent hover:text-accent-light no-underline"
        >Parliament website</a
      >.
    </p>
    <p>
      The full bills (including drafts after the first reading) can be found on
      the <a
        href="https://sso.agc.gov.sg/Browse/Bills-Supp"
        class="text-accent hover:text-accent-light no-underline"
        >Attorney-General's Chambers website</a
      >.
    </p>
  </div>

  <PaginatedList
    client:visible
    contentType="bill"
    dataUrl="/data/bills.json"
    totalCount={totalCount}
    pageSize={PAGE_SIZE}
    placeholder="Search bills by title or ministry..."
    initialItems={initialItems}
  />
</Layout>
