---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import PaginatedList from "../../components/islands/PaginatedList";
import { getMotions, getMotionCount } from "../../lib/db";
import type { ListItem } from "../../lib/types";

const PAGE_SIZE = 20;
const totalCount = getMotionCount();
const motions = getMotions(PAGE_SIZE, 0);

// Transform to match the ListItem interface
const initialItems: ListItem[] = motions.map((m) => ({
  id: m.id,
  title: m.sectionTitle,
  date: m.sessionDate,
  type: m.sectionType,
  category: m.category || undefined,
  ministry: m.ministry || undefined,
  speakers: m.speakers?.map((s) => s.name) || [],
  snippet: m.contentPlain?.substring(0, 150),
}));
---

<Layout title="Motions" description="Browse Singapore Parliament motions">
  <SectionLabel>Parliamentary Proceedings</SectionLabel>

  <h1 class="font-display text-display-lg text-ink mb-4">Motions</h1>

  <p
    class="font-body text-base text-ink-soft leading-relaxed max-w-[58ch] mb-8"
  >
    Browse parliamentary motions and adjournment motions. Motions are formal
    proposals put before Parliament for debate and decision. Click on a motion
    to see the full transcript.
  </p>

  <PaginatedList
    client:visible
    contentType="motion"
    dataUrl="/data/motions.json"
    totalCount={totalCount}
    pageSize={PAGE_SIZE}
    placeholder="Search motions by title, speaker, or content..."
    initialItems={initialItems}
  />
</Layout>
