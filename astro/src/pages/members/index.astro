---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import MemberCard from "../../components/MemberCard.astro";
import SearchFilter from "../../components/SearchFilter.astro";
import { getMembersWithInfo, getMemberCount } from "../../lib/db";

const members = getMembersWithInfo();
const STAGGER_LIMIT = 12;
const totalCount = getMemberCount();
---

<Layout title="MPs" description="Browse Singapore Members of Parliament">
  <h1 class="font-display text-display-lg text-ink mb-4">
    Members of Parliament
  </h1>

  <div
    class="font-body text-base text-ink-soft leading-relaxed mb-8 space-y-3 text-pretty"
  >
    <p>
      Here, you can find the individual profiles of Members of Parliament (MPs)
      along with their records of their involvements in Parliament. The
      individual pages of each MP also have AI-generated summaries of their 20
      latest contributions in Parliament.
    </p>
    <p>
      In Singapore, there are three types of MPs: elected, non-constituency, and
      nominated.
    </p>

    <section>
      <h3 class="mb-3 text-xl font-bold text-ink">Elected Members</h3>
      <p>
        Singapore is divided into different geographical areas known as
        constituencies. During elections, the residents of each constituency
        vote for one or more MPs who will represent them in Parliament. Some of
        these MPs will be appointed to positions in the Government and become
        office holders. The rest of the elected MPs are known as backbenchers.
        Office holders include Ministers, Senior Ministers of State, Ministers
        of State, and Senior Parliamentary Secretaries.
      </p>
    </section>

    <section>
      <h3 class="mb-3 text-xl font-bold text-ink">Non-Constituency Members</h3>
      <p>
        NCMPs are declared as MPs from opposition parties who were not elected
        in the General Election, but received the highest percentage of votes
        amongst the unelected candidates from the opposition parties.
      </p>
    </section>

    <section>
      <h3 class="mb-3 text-xl font-bold text-ink">Nominated Members</h3>
      <p>
        NMPs are appointed by the President of Singapore and are meant to
        provide non-partisan views in Parliament.
      </p>
    </section>

    <p>
      Don't know who your MP is? Enter your postal code in the map below to find
      out!
    </p>
    <div class="w-full overflow-hidden">
      <iframe
        title="2025 General Election Results Map"
        src="https://elections.data.gov.sg/en/map?isScrollable=true&primaryColor=%236253E8&view=Winning%20margin&lang=en&year=2025&constituenciesView=all"
        class="h-[980px] w-full border-none sm:h-[740px] md:h-[620px]"></iframe>
    </div>
  </div>

  <SearchFilter
    containerId="members-list"
    itemSelector=".member-item"
    contentType="member"
    placeholder="Search by name, constituency, or designation..."
  />

  <p
    class="font-sans text-sm text-ink-muted mb-6"
    data-search-count="members-list"
  >
    Showing {members.length} of {totalCount} members
  </p>

  <div id="members-list" class="grid gap-4 sm:grid-cols-2">
    {
      members.length === 0 ? (
        <p class="col-span-full py-12 text-center font-body text-ink-muted">
          No members found
        </p>
      ) : (
        members.map((member, i) => {
          const isStaggered = i < STAGGER_LIMIT;
          return (
            <div
              class={`member-item h-full${isStaggered ? " animate-fade-up" : ""}`}
              style={
                isStaggered ? `animation-delay: ${0.1 + i * 0.03}s` : undefined
              }
            >
              <MemberCard member={member} />
            </div>
          );
        })
      )
    }
  </div>
</Layout>
