---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import PaginatedList from "../../components/islands/PaginatedList";
import { getQuestions, getQuestionCount } from "../../lib/db";
import type { ListItem } from "../../lib/types";

const PAGE_SIZE = 20;
const totalCount = getQuestionCount();
const questions = getQuestions(PAGE_SIZE, 0);

// Transform to match the ListItem interface
const initialItems: ListItem[] = questions.map((q) => ({
  id: q.id,
  title: q.sectionTitle,
  date: q.sessionDate,
  type: q.sectionType,
  category: q.category || undefined,
  ministry: q.ministry || undefined,
  speakers: q.speakers?.map((s) => s.name) || [],
  snippet: q.contentPlain?.substring(0, 150),
}));
---

<Layout
  title="Questions"
  description="Browse Singapore Parliament questions and answers"
>
  <h1 class="font-display text-display-lg text-ink mb-4">
    Parliamentary Questions
  </h1>

  <div
    class="font-body text-base text-ink-soft leading-relaxed mb-8 space-y-3 text-pretty"
  >
    <p>
      Here, you can find all parliamentary questions (PQs) that have been asked.
      PQs are formal inquiries made by MPs to ministers for information,
      clarification, or updates on specific issues. There are two types of PQs
      that can be asked: oral and written. Each MP can file up to 5 PQs per
      sitting (three oral and two written). After the initial answer from the
      Minister, supplementary questions may be asked by any MP.
    </p>
    <p>
      <strong class="text-ink">Oral questions</strong> are answered and can be debated
      during question time, the first 90 minutes of each sitting. The order of questions
      to be answered is decided by the Leader of the House, and is published in the
      Order Paper prior to the sitting. After 90 minutes, the remaining questions
      which have not been answered will be provided with written answers.
    </p>
    <p>
      <strong class="text-ink">Written questions</strong> are not answered during
      question time and are instead provided with written answers. They are also included
      in the Order Paper.
    </p>
  </div>

  <PaginatedList
    client:visible
    contentType="question"
    dataUrl="/data/questions.json"
    totalCount={totalCount}
    pageSize={PAGE_SIZE}
    placeholder="Search questions by title, speaker, or content..."
    initialItems={initialItems}
  />
</Layout>
