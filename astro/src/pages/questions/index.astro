---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import PaginatedList from "../../components/islands/PaginatedList";
import { getQuestions, getQuestionCount } from "../../lib/db";
import type { ListItem } from "../../lib/types";

const PAGE_SIZE = 20;
const totalCount = getQuestionCount();
const questions = getQuestions(PAGE_SIZE, 0);

// Transform to match the ListItem interface
const initialItems: ListItem[] = questions.map((q) => ({
  id: q.id,
  title: q.sectionTitle,
  date: q.sessionDate,
  type: q.sectionType,
  category: q.category || undefined,
  ministry: q.ministry || undefined,
  speakers: q.speakers?.map((s) => s.name) || [],
  snippet: q.contentPlain?.substring(0, 150),
}));
---

<Layout
  title="Questions"
  description="Browse Singapore Parliament questions and answers"
>
  <SectionLabel>Question Time</SectionLabel>

  <h1 class="font-display text-display-lg text-ink mb-4">
    Parliamentary Questions
  </h1>

  <p
    class="font-body text-base text-ink-soft leading-relaxed max-w-[58ch] mb-8"
  >
    Browse parliamentary questions and their answers. Questions can be oral
    (OA), written (WA), or written without answer (WANA). Click on a question to
    see the full transcript.
  </p>

  <PaginatedList
    client:visible
    contentType="question"
    dataUrl="/data/questions.json"
    totalCount={totalCount}
    pageSize={PAGE_SIZE}
    placeholder="Search questions by title, speaker, or content..."
    initialItems={initialItems}
  />
</Layout>
